<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Funny Twist Chess</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css" />
  <style>
    body { display: flex; flex-direction: column; align-items: center; font-family: Arial; background: #fdfdfb; }
    #board { width: 400px; margin: 20px; }
    .white-1e1d7 { background-color: #f0e5cf !important; } /* cream */
    .black-3c85d { background-color: #4a90e2 !important; } /* blue */
    #timer { font-size: 20px; margin: 10px; }
    #quote { margin-top: 15px; font-style: italic; color: #333; text-align: center; max-width: 400px; }
  </style>
</head>
<body>
  <h2>Funny Twist Chess</h2>
  <div id="timer">White: 05:00 | Black: 05:00</div>
  <div id="board"></div>
  <div id="quote">Game Start! Donâ€™t mess it up ðŸ˜‰</div>

  <script>
    const funnyQuotes = [
      "Thatâ€™s illegal in 47 countries!",
      "Did you just move with Google Maps?",
      "Checkmate? More like check-wait!",
      "My grandma moves faster than that!",
      "Are you playing chess or Minesweeper?",
      "Congratulations, you just invented a new blunder!"
    ];

    const game = new Chess();
    const board = Chessboard('board', {
      draggable: true,
      position: 'start',
      onDrop: onDrop,
      onSnapEnd: onSnapEnd,
      pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
    });

    let whiteTime = 300; // 5 min
    let blackTime = 300;
    let currentTurn = 'w';
    let timerInterval = setInterval(updateTimer, 1000);

    function updateTimer(){
      if(game.game_over()) return;
      if(currentTurn === 'w') whiteTime--; else blackTime--;
      document.getElementById("timer").textContent = `White: ${formatTime(whiteTime)} | Black: ${formatTime(blackTime)}`;
      if(whiteTime <= 0 || blackTime <= 0){
        alert("Time's up! " + (whiteTime <= 0 ? "Black wins!" : "White wins!"));
        clearInterval(timerInterval);
      }
    }

    function formatTime(t){
      let m = Math.floor(t/60).toString().padStart(2,'0');
      let s = (t%60).toString().padStart(2,'0');
      return `${m}:${s}`;
    }

    function onDrop(source, target){
      let move = game.move({ from: source, to: target, promotion: 'q' });
      if(move === null) return 'snapback';

      currentTurn = game.turn();
      document.getElementById("quote").textContent = funnyQuotes[Math.floor(Math.random()*funnyQuotes.length)];

      setTimeout(() => {
        if(game.in_draw() || game.in_stalemate() || game.in_threefold_repetition()){
          twistTheGame();
        }
      }, 200);
    }

    function twistTheGame(){
      let pieces = game.board();
      let pawns = [];
      for(let r=0;r<8;r++){
        for(let c=0;c<8;c++){
          if(pieces[r][c] && pieces[r][c].type === 'p'){
            pawns.push({square: String.fromCharCode(97+c)+(8-r), color: pieces[r][c].color});
          }
        }
      }
      if(pawns.length>0){
        let luckyPawn = pawns[Math.floor(Math.random()*pawns.length)];
        let upgrade = ['q','r','b','n'][Math.floor(Math.random()*4)];
        game.remove(luckyPawn.square);
        game.put({type: upgrade, color: luckyPawn.color}, luckyPawn.square);
        board.position(game.fen());
        document.getElementById("quote").textContent = `Plot twist! A pawn just evolved into a ${upgrade.toUpperCase()} ðŸ˜†`;
      }
    }

    function onSnapEnd(){
      board.position(game.fen());
    }
  </script>
</body>
</html>
